# Задание
## Создайте веб-приложение с API-интерфейсом и админ-панелью.
## Создайте базу данных, используя миграции Django.
### Требования к реализации:

1 Необходимо реализовать модель сети по продаже электроники.
Сеть должна представлять собой иерархическую структуру из трех уровней:
- завод;
- розничная сеть;
- индивидуальный предприниматель.  
 
Каждое звено сети ссылается только на одного поставщика оборудования (не обязательно предыдущего по иерархии). 
Важно отметить, что уровень иерархии определяется не названием звена, а отношением к остальным элементам сети, т. е. завод всегда находится на уровне 0, а если розничная сеть относится напрямую к заводу, минуя остальные звенья, ее уровень — 1.

# Мой комментарий
Иерархичность обеспечивается в неявном виде за счет наличия поля "Поставщик". 
Следовательно, цепочка поставки может быть неограниченной.

2 Каждое звено сети должно обладать следующими элементами:
- Название.
- Контакты:
-- email,
-- страна,
-- город,
-- улица,
-- номер дома.
- Продукты:
-- название,
-- модель,
-- дата выхода продукта на рынок.
- Поставщик (предыдущий по иерархии объект сети).
- Задолженность перед поставщиком в денежном выражении с точностью до копеек.
- Время создания (заполняется автоматически при создании).

# Мой комментарий
Таблицы "Контакты" и "Продукты" к таблице "Звено" относятся как Многие-ко-Многим.

3 Сделать вывод в админ-панели созданных объектов.  
На странице объекта сети добавить:
- ссылку на «Поставщика»;
- фильтр по названию города;
- admin action, очищающий задолженность перед поставщиком у выбранных объектов.

# Мой комментарий
Ссылка на поставщика в административной панели добавляется автоматически через ForeignKey

4 Используя DRF, создать набор представлений:  
CRUD для модели поставщика (запретить обновление через API поля «Задолженность перед поставщиком»).  
Добавить возможность фильтрации объектов по определенной стране.

5 Настроить права доступа к API так, чтобы только активные сотрудники имели доступ к API.

# Мой комментарий
Данный функционал реализуется средствами по умолчанию. Поле is_active в User.

***
# Настройка и запуск
Данный проект состоит из двух приложений:
- основное приложение ImagesLoader_DRF:
- сервис по обработке изображений ImagesProcessor_FastAPI.  
Папки с этими двумя приложениями должны находиться в одной директории. К примеру:
```
ImagesLoader/ImagesLoader_DRF/...
ImagesLoader/ImagesProcessor_FastAPI/...
```
В проекте использован pip в качестве инструмента управления зависимостями.  
Запуск возможен локально или через Docker.

ВНИМАНИЕ! В репозитории намеренно добавлены ```.env``` файлы!

## Локальный запуск
### Запуск ImagesLoader_DRF
Перед запуском убедитесь в наличии файла ```.env``` в корневом каталоге проекта.  
Пример заполнения данного файла можно найти в ```.env.sample```.  
В проекте используется PostgreSQL, убедитесь, что данный сервис установлен и доступен.  
Перед запуском проекта создайте БД с именем по ключу POSTGRES_DB, что указан в ```.env``` файле.   
Примените миграции ```python manage.py migrate``` и запустите сервер, используя команду ```python manage.py runserver```  

## Тестирование
Для запуска тестов используется команда```coverage run --source='.' manage.py test```  
Для проверки покрытия используется команда```coverage report -m```  

# Регистрация, авторизация
## Регистрация
Чтобы начать пользоваться системой, необходимо выполнить регистрацию. 
Во время регистрации необходимо указать поля username, password.  
URL для регистрации: ```POST /users/users/``` 

## Авторизация
В качестве способа авторизации используется JWT. При запросе возвращается Bearer access token и refresh token.  
URL для получения токенов: ```POST /users/token/``` 

# Использование API
Авторизованный пользователь имеет возможность:
- Выполнить полный CRUD с контактами.  
Создать контакт ```POST /retail/conacts/```  
Получить список контактов ```GET /retail/conacts/```  
Получить контакт по pk ```GET /retail/conacts/<int:pk>/```  
Обновить контакт по pk ```PUT /retail/conacts/<int:pk>/```  
Частично обновить контакт по pk ```PATCH /retail/conacts/<int:pk>/>```  
Удалить контакт по pk ```DELETE /retail/conacts/<int:pk>>/```  
- Выполнить полный CRUD с продуктами.  
Создать продукт ```POST /retail/products/```  
Получить список продуктов ```GET /retail/products/```  
Получить продукт по pk ```GET /retail/products/<int:pk>/```  
Обновить продукт по pk ```PUT /retail/products/<int:pk>/```  
Частично обновить продукт по pk ```PATCH /retail/products/<int:pk>/>```  
Удалить продукт по pk ```DELETE /retail/products/<int:pk>>/```   
- Выполнить полный CRUD со звеньями цепи поставки продуктов.  
Создать звено ```POST /retail/chain/create/```  
Получить список звеньев ```GET /retail/chain/list/```  
Получить звено по pk ```GET /retail/chain/<int:pk>/```  
Обновить звено по pk ```PUT /retail/chain/update/<int:pk>/```  
Частично обновить звено по pk ```PATCH /retail/chain/update/<int:pk>/```    
Удалить звено по pk ```DELETE /retail/chain/delete/<int:pk>/```    

# Админка
В административной панели доступны все три таблицы.
Для элемента "Звено" дополнительно доступны фильтры по поставщикам, странам, городам, наличию задолженности.  
Так-же добавлено быстрое действие "Очистить задолженность перед поставщиком".
 

## Автогенерируемая документация
Документация на основе OpenAPI доступна по URL:  
```/docs/swagger/```   
```/docs/redoc/``` 

## Ссылки на репозитории
https://github.com/ChurilovEvgeny/RetailChain_DRF
